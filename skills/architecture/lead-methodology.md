# Lead 角色方法论参考

> 本文件是 /cc-best:lead 命令的知识参考，由 architect agent 预加载。
> 包含：PM 决策复核框架、追溯链与任务组织、设计文档模板、任务文档模板、任务列表格式、任务分解原则、设计原则、方案可行性评估框架。

---

## PM 决策复核框架

### 评审重点

| PM 决策置信度 | Lead 评审动作                      |
| ------------- | ---------------------------------- |
| **高**        | 快速确认，通常直接采纳             |
| **中**        | 仔细评估技术可行性，必要时调整     |
| **低**        | 重点评审，结合技术约束做出最终决策 |

### 决策调整原则

```
1. PM 决策技术上可行？
   └─ 是 → 采纳，继续设计
   └─ 否 → 调整决策，记录原因

2. 有更优的技术方案？
   └─ 是 → 提出替代方案，记录权衡
   └─ 否 → 按原方案执行

3. 决策影响范围？
   └─ 局部 → Lead 直接调整
   └─ 全局 → 调整并在设计文档中说明
```

### 调整记录格式

在 DES 文档的"技术评审"部分记录：

```markdown
## 技术评审

### PM 决策评审

| PM 决策  | Lead 判断 | 调整     | 原因                  |
| -------- | --------- | -------- | --------------------- |
| 使用 JWT | 采纳      | -        | 项目已有 JWT 基础设施 |
| 不含注册 | 调整      | 需要注册 | 登录依赖用户存在      |

### 技术可行性

- [评估结果]
```

---

## 追溯链与任务组织

### 追溯链示例

```
REQ-001 用户登录功能
  └── DES-001 登录模块设计
        │
        ├── Phase 1: Setup
        │   └── TSK-001 项目初始化
        │
        ├── Phase 2: US-1 登录功能 (P1 - MVP) 🎯
        │   ├── TSK-002 [US1] 实现用户模型
        │   ├── TSK-003 [US1] 实现登录API
        │   └── TSK-004 [US1] 实现JWT认证
        │
        └── Phase 3: US-2 注册功能 (P2)
            ├── TSK-005 [US2] 实现注册API
            └── TSK-006 [US2] 实现邮箱验证
```

### 任务组织原则（借鉴 Spec-Kit）

> **关键**: 任务按 User Story 组织，每个 Story 可独立实现和测试

```
Phase 1: Setup（共享基础设施）
  └─ 所有 Story 共用的初始化任务

Phase 2: User Story 1 (P1 - MVP) 🎯
  └─ 实现后即可独立演示

Phase 3: User Story 2 (P2)
  └─ 实现后可增量交付

Phase N: Polish（跨 Story 优化）
  └─ 文档、性能、安全等
```

---

## 设计文档模板 (DES-XXX.md)

````markdown
# DES-XXX: [设计名称]

## 元信息

- **编号**: DES-XXX
- **关联需求**: REQ-XXX
- **状态**: draft
- **创建日期**: YYYY-MM-DD

## 需求概述

[引用自 REQ-XXX，包含原始需求]

## 技术评审

### PM 决策评审

| PM 决策 | Lead 判断 | 调整   | 原因   |
| ------- | --------- | ------ | ------ |
| [决策1] | 采纳/调整 | [如有] | [原因] |
| [决策2] | 采纳/调整 | [如有] | [原因] |

### 技术可行性

- 可行性评估：[结果]
- 技术风险：[识别的风险]
- 架构兼容性：[评估]

## 架构设计

[模块结构和关系]

## 接口定义

### API 端点

| 端点       | 方法 | 请求体             | 响应体        | 错误码      |
| ---------- | ---- | ------------------ | ------------- | ----------- |
| `/api/xxx` | POST | `CreateXxxRequest` | `XxxResponse` | 400/401/500 |

### 数据模型

```typescript
// 请求模型
interface CreateXxxRequest {
  field1: string;
  field2?: number;
}

// 响应模型
interface XxxResponse {
  id: string;
  createdAt: string;
}

// 实体模型
interface XxxEntity {
  id: string;
  // ...
}
```
````

### 错误处理

| 错误码 | 场景         | 响应格式                              |
| ------ | ------------ | ------------------------------------- |
| 400    | 参数校验失败 | `{ error: string, fields: string[] }` |
| 401    | 未授权       | `{ error: "Unauthorized" }`           |

## 任务分解

| 任务编号 | 任务名称 | 复杂度 | 依赖    |
| -------- | -------- | ------ | ------- |
| TSK-XXX  | 任务1    | 低     | -       |
| TSK-XXX  | 任务2    | 中     | TSK-XXX |

## 风险与缓解

| 风险    | 影响   | 缓解措施 |
| ------- | ------ | -------- |
| [风险1] | [影响] | [措施]   |

````

---

## 任务文档模板 (TSK-XXX.md)

```markdown
# TSK-XXX: [任务名称]

## 元信息

- **编号**: TSK-XXX
- **关联设计**: DES-XXX
- **关联需求**: REQ-XXX
- **关联 User Story**: US-N (P1/P2/P3)
- **状态**: pending
- **复杂度**: 低 | 中 | 高
- **可并行**: 是/否 [P]

## 任务描述

[详细描述]

## 完成标准

- [ ] 标准1
- [ ] 标准2

## 涉及文件

- `path/to/file.py`

## 任务契约

<!-- 明确任务的输入输出，确保任务独立性 -->

- **输入依赖**: [从哪个任务/模块获取什么] 或 "无"
- **输出产物**: [产出什么接口/数据供后续使用] 或 "无"

## 依赖任务

<!-- 必填：无依赖写"无"，有依赖必须说明原因 -->

- 无 / TSK-XXX: [依赖原因]

## TDD 规格

### 测试用例

<!-- 从 REQ 的验收场景转化，Dev 按此编写测试 -->

- [ ] `test_xxx_when_yyy_should_zzz` - [对应验收场景]
- [ ] `test_xxx_edge_case` - [边界情况]

### Mock 依赖

| 依赖模块 | Mock 方式 | 返回值示例 |
| -------- | --------- | ---------- |
| `XxxRepository` | `MockXxxRepository` | `{ id: "1", ... }` |

### 测试数据

- 正常场景: `fixtures/xxx_valid.json` 或内联数据
- 边界场景: `fixtures/xxx_edge.json`
- 错误场景: `fixtures/xxx_error.json`

## 检查点

完成后，该 User Story 应可独立验证：[验证方式]
```

---

## 任务列表格式（按 User Story 组织）

```markdown
## Phase 1: Setup（共享基础设施）

**目的**: 项目初始化，所有 Story 共用

- [ ] TSK-001 初始化项目结构
- [ ] TSK-002 [P] 配置开发环境
- [ ] TSK-003 [P] 配置 CI/CD

---

## Phase 2: User Story 1 - [标题] (P1 - MVP) 🎯

**目标**: [Story 描述]
**独立验证**: [如何验证这个 Story]

- [ ] TSK-004 [US1] 实现 XXX 模型
- [ ] TSK-005 [US1] [P] 实现 XXX 服务
- [ ] TSK-006 [US1] 实现 XXX API

**检查点**: 完成后 US1 可独立演示

---

## Phase 3: User Story 2 - [标题] (P2)

**目标**: [Story 描述]
**独立验证**: [如何验证]

- [ ] TSK-007 [US2] 实现 XXX
- [ ] TSK-008 [US2] 实现 XXX

---

## 任务依赖说明

- Setup 完成后，所有 User Story 可并行开始
- 同一 Story 内的 [P] 任务可并行
- 跨 Story 任务尽量无依赖（独立可测原则）
```

---

## 任务分解原则

### 最小工作单元标准

- 一个任务 = 一个明确的产出
- 可独立验证
- 预估复杂度：低/中/高

### 任务依赖规则

```
接口定义 → 基础实现 → 集成测试
    ↓
单元测试
```

---

## 设计原则

- **KISS**: 保持简单，不过度设计
- **复用优先**: 先看是否有可复用代码
- **渐进式**: 先实现核心，再扩展
- **接口先行**: 先定义接口，再实现

---

## 自主决策原则

> **Lead 在技术评审中有权调整 PM 的决策，但必须记录调整原因**

| 场景              | 决策                     |
| ----------------- | ------------------------ |
| PM 决策技术不可行 | 调整为可行方案，记录原因 |
| 有更优技术方案    | 采用更优方案，记录权衡   |
| PM 决策合理       | 直接采纳，快速推进       |
| 不确定最优方案    | 选择最简单可行方案       |

---

## 方案可行性评估框架

> **借鉴置信度评估原则：仅当可行性 >= 80% 时自主执行**

### 评估矩阵

在 DES 文档中添加方案评估表：

```markdown
## 方案可行性评估

### 评估矩阵

| 方案 | 可行性 | 复杂度 | 风险 | 推荐度      |
| ---- | ------ | ------ | ---- | ----------- |
| A    | 90%    | 低     | 低   | ⭐⭐⭐ 推荐 |
| B    | 70%    | 中     | 中   | ⭐⭐ 备选   |
| C    | 50%    | 高     | 高   | ⭐ 待确认   |

### 可行性评估依据

| 方案 | 评估依据                                 |
| ---- | ---------------------------------------- |
| A    | 项目已有类似实现，技术栈匹配，无外部依赖 |
| B    | 需要引入新库，但社区成熟，有迁移成本     |
| C    | 需要架构调整，影响范围大，团队无经验     |
```

### 可行性等级定义

| 可行性 | 定义                 | 处理方式           |
| ------ | -------------------- | ------------------ |
| >=80%  | 高置信度，有明确依据 | 直接执行           |
| 60-79% | 中置信度，有一定风险 | 执行但关注风险点   |
| <60%   | 低置信度，不确定性高 | 标记 TBD，请求确认 |

### 评估因素

| 因素     | 权重 | 评估问题               |
| -------- | ---- | ---------------------- |
| 技术匹配 | 30%  | 是否与现有技术栈兼容？ |
| 已有实现 | 25%  | 项目中是否有类似模式？ |
| 外部依赖 | 20%  | 是否需要新的外部依赖？ |
| 团队经验 | 15%  | 团队是否有相关经验？   |
| 时间风险 | 10%  | 是否有明确的实现路径？ |

### 执行建议

- 仅当推荐方案可行性 >= 80% 时自主执行
- 可行性 60-79% 时，在 DES 文档中标注"关注风险"
- 可行性 < 60% 时，标注"待用户确认"，列出关键不确定点
````
