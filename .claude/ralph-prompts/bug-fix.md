# Ralph Loop 提示词模板 - Bug 修复

## 任务目标

分析并修复指定的 Bug，确保问题彻底解决且不引入新问题。

## 输入

<!-- 在此填写 Bug 描述 -->
```
Bug 描述: {{BUG_DESCRIPTION}}
复现步骤: {{REPRODUCE_STEPS}}
预期行为: {{EXPECTED_BEHAVIOR}}
实际行为: {{ACTUAL_BEHAVIOR}}
```

---

## 修复流程

### Step 1: 复现 Bug

1. **验证 Bug 存在**
   - 按照复现步骤操作
   - 确认问题确实存在
   - 记录错误信息/日志

2. **如果无法复现**
   - 检查环境差异
   - 检查数据依赖
   - 输出 `<promise>CANNOT_REPRODUCE</promise>`

### Step 2: 定位原因

1. **分析错误信息**
   - 查看错误堆栈
   - 查看相关日志
   - 确定问题代码位置

2. **理解代码逻辑**
   - 读取相关代码
   - 理解业务流程
   - 识别问题根因

3. **区分问题类型**
   - 逻辑错误
   - 边界条件未处理
   - 并发问题
   - 数据问题
   - 依赖问题

### Step 3: 编写测试

1. **创建失败测试**
   - 编写能复现 Bug 的测试用例
   - 确认测试失败（红灯）

2. **测试边界情况**
   - 识别相关边界条件
   - 添加边界测试用例

### Step 4: 修复问题

1. **最小修改原则**
   - 只修改必要的代码
   - 不做无关的重构

2. **验证修复**
   - 运行新增的测试（绿灯）
   - 运行完整测试套件
   - 手动验证（如需要）

### Step 5: 提交代码

1. **提交格式**
   ```
   fix(scope): 简短描述

   问题原因: [根因分析]
   修复方案: [修复说明]

   Closes #issue-number (如有)
   ```

---

## 完成标准

当满足以下**所有**条件时输出 `<promise>BUG_FIXED</promise>`：

- [ ] Bug 已复现并确认
- [ ] 根因已定位
- [ ] 测试用例已添加
- [ ] 修复代码已实现
- [ ] 所有测试通过
- [ ] 代码已提交

---

## 修复原则

### 根因分析
- 找到**根本原因**，而不是表面症状
- 考虑"为什么会出现这个问题"
- 防止类似问题再次发生

### 影响范围
- 评估修复的影响范围
- 检查是否有其他地方有类似问题
- 确保不引入新问题

### 回归测试
- 运行完整测试套件
- 特别关注相关模块的测试

---

## 卡住时的处理

### 无法定位原因
1. 添加更多日志
2. 缩小问题范围
3. 二分法定位
4. 如果仍然无法定位，输出 `<promise>BLOCKED_ANALYSIS</promise>`

### 修复引入新问题
1. 回退修改
2. 分析新问题原因
3. 尝试更安全的修复方案

---

## 输出格式

```markdown
## Bug 修复迭代 #N

### 当前步骤
[复现/定位/测试/修复/提交]

### 执行动作
1. [动作1]
2. [动作2]

### 发现
- 根因: [问题根因]
- 影响: [影响范围]

### 修改文件
- [文件1]: [修改说明]

### 测试结果
- 新增测试: X 个
- 测试状态: 通过/失败

### 下一步
[继续修复/完成信号]
```

---

## 使用示例

```bash
/ralph-loop "读取 .claude/ralph-prompts/bug-fix.md 作为执行指南。Bug: 用户登录后偶尔会被踢出，复现步骤是快速连续点击登录按钮" --max-iterations 20 --completion-promise "BUG_FIXED"
```
