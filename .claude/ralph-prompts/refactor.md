# Ralph Loop 提示词模板 - 代码重构

## 任务目标

按照重构计划逐步重构代码，确保每一步测试都通过。

## 重构计划

<!-- 在此定义具体的重构目标 -->
1. [重构目标1]
2. [重构目标2]
3. [重构目标3]

## 执行流程

每次迭代：

1. **选择目标** - 从重构计划中选择下一个目标
2. **分析依赖** - 确认修改影响范围
3. **执行重构** - 一次只改一个文件/模块
4. **运行测试** - 确保测试通过
5. **提交变更** - 使用 `refactor(scope): description` 格式

## 完成标准

当满足以下条件时输出 `<promise>REFACTOR_DONE</promise>`：

- [ ] 所有重构目标完成
- [ ] 所有测试通过
- [ ] 代码风格一致
- [ ] 无遗留 TODO 或 FIXME

## 重构原则

### 安全重构
- 每次只改一个文件
- 改完立即测试
- 测试不通过则回退

### 常见重构模式
- 提取函数/方法
- 提取类/模块
- 重命名
- 移动代码
- 简化条件表达式
- 消除重复

## 卡住时的处理

如果某个重构导致测试失败且难以修复：

1. 回退本次修改
2. 记录失败原因
3. 尝试更小粒度的重构
4. 如果仍然失败，标记为需要人工决策

## 输出格式

```markdown
## 重构迭代 #N

### 重构目标
[本次重构的具体目标]

### 修改文件
- [文件1]: [修改说明]
- [文件2]: [修改说明]

### 测试结果
- 状态: 通过/失败
- 影响范围: [受影响的测试]

### 剩余目标
- [ ] 目标1
- [x] 目标2 (已完成)

### 下一步
[继续重构/完成信号]
```
