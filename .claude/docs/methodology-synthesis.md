# 方法论体系深度对比与融合

基于 GitHub Spec-Kit 和我们现有模板的深度分析，形成独特的方法论体系。

---

## 一、两个体系的设计哲学对比

### 1.1 核心理念

| 维度 | Spec-Kit | 我们的模板 |
|------|----------|-----------|
| **核心理念** | Spec-Driven Development（规范驱动） | Role-Based Autonomous Development（角色自主开发） |
| **哲学基础** | 先规范后代码 | 道法术器（完整方法论） |
| **决策模式** | 明确澄清后才行动 | 基于上下文自主推断 |
| **质量保证** | 需求质量检查（Checklist） | 下游角色纠偏 |
| **流程特点** | 线性流转、门禁严格 | 循环迭代、自我纠正 |

### 1.2 命令/角色对比

| 阶段 | Spec-Kit 命令 | 我们的角色 | 差异分析 |
|------|--------------|-----------|---------|
| 原则定义 | `/constitution` | `CLAUDE.md` + `methodology.md` | Spec-Kit 版本化管理更好 |
| 需求规范 | `/specify` | `/pm` (REQ) | 我们有决策置信度，Spec-Kit 有质量检查 |
| 需求澄清 | `/clarify` | *融入 /pm* | **我们缺失独立澄清阶段** |
| 技术计划 | `/plan` | `/lead` (DES) | 类似，我们有 PM 决策评审 |
| UI 设计 | - | `/designer` | **我们独有** |
| 任务生成 | `/tasks` | `/lead` (TSK) | Spec-Kit 按 Story 组织更好 |
| 需求检查 | `/checklist` | - | **我们缺失需求质量检查** |
| 一致性分析 | `/analyze` | - | **我们缺失一致性分析** |
| 实现 | `/implement` | `/dev` | 类似，我们有前端验证 |
| 测试 | - | `/qa` | 我们有问题分类能力 |

### 1.3 独特优势对比

**Spec-Kit 独特优势：**
1. **Constitution 版本化** - 原则有版本号、修订记录、合规检查
2. **Checklist = 需求的单元测试** - 检查需求质量而非代码
3. **Handoffs 结构化交接** - YAML 定义下一步选项
4. **NEEDS CLARIFICATION 限制** - 最多 3 个待澄清项
5. **User Story 独立可测** - P1 = MVP，可独立交付
6. **Analyze 一致性检查** - 发现需求-设计-任务的冲突

**我们模板独特优势：**
1. **道法术器哲学** - 完整的方法论体系
2. **自主决策原则** - 不中断循环，基于上下文推断
3. **决策置信度** - 高/中/低，下游可纠偏
4. **问题分类能力** - 区分实现 Bug 和需求假设错误
5. **Designer 角色** - 避免 AI 通用审美
6. **Memory Bank** - 长期记忆和上下文恢复
7. **前端验证** - Playwright 浏览器自动化
8. **官方插件集成** - code-explorer、code-architect、frontend-design

---

## 二、融合方案设计

### 2.1 设计原则

1. **保留我们的核心优势** - 角色体系、自主决策、道法术器
2. **吸收 Spec-Kit 精华** - 质量检查、结构化交接、独立可测
3. **形成独特体系** - 不是简单拼凑，而是有机融合
4. **保持简洁实用** - 不增加不必要的复杂度

### 2.2 融合架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       道法术器 + Spec-Driven 融合体系                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  道 (Constitution)                                                          │
│  ├── CLAUDE.md (项目宪法，版本化)                                             │
│  ├── methodology.md (开发哲学)                                               │
│  └── 合规检查贯穿全流程                                                       │
│                                                                             │
│  法 (Specification)                                                         │
│  ├── /pm → REQ-XXX (含优先级 P1/P2/P3)                                       │
│  │     ├── 决策置信度记录                                                     │
│  │     ├── 需求质量自检 (Checklist)                                          │
│  │     └── 待澄清项限制 (≤3)                                                 │
│  │                                                                          │
│  └── /lead → DES-XXX + TSK-XXX                                              │
│        ├── PM 决策评审                                                       │
│        ├── 按 User Story 组织任务                                            │
│        └── 独立可测设计                                                       │
│                                                                             │
│  术 (Implementation)                                                        │
│  ├── /designer → UI 设计指导 (避免 AI Slop)                                  │
│  ├── /dev → 编码实现 + 前端验证                                               │
│  └── /qa → 测试验证 + 问题分类                                                │
│                                                                             │
│  器 (Tools & Agents)                                                        │
│  ├── 官方插件: code-explorer, code-architect, frontend-design               │
│  ├── 内置 Agent: planner, code-reviewer, security-reviewer, tdd-guide       │
│  └── Playwright 浏览器验证                                                   │
│                                                                             │
│  质量保证层                                                                   │
│  ├── /checkpoint → 检查点管理                                                │
│  ├── 需求质量检查 (从 Spec-Kit 借鉴)                                          │
│  └── 一致性分析 (新增)                                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 具体融合点

#### A. Constitution 版本化 (借鉴 Spec-Kit)

**改进 CLAUDE.md：**
```markdown
# {{PROJECT_NAME}} Constitution

**Version**: 1.0.0 | **Ratified**: 2026-01-22 | **Last Amended**: 2026-01-22

## 核心原则 (Non-Negotiable)
...

## 版本历史
| 版本 | 日期 | 变更 | 原因 |
|------|------|------|------|
| 1.0.0 | 2026-01-22 | 初始版本 | 项目启动 |
```

#### B. 需求优先级 + 独立可测 (借鉴 Spec-Kit)

**改进 REQ 模板：**
```markdown
## User Stories（按优先级排列）

### US-1: [标题] (P1 - MVP) 🎯
**价值**: [为什么是最高优先级]
**独立测试**: [如何独立验证这个 Story]
**验收场景**:
- Given [前置], When [动作], Then [结果]

### US-2: [标题] (P2)
...
```

#### C. 需求质量检查 (借鉴 Spec-Kit)

**在 /pm 输出前增加自检：**
```markdown
## 需求质量自检

### 完整性
- [ ] 每个 User Story 独立可测试？
- [ ] 边界情况已识别？
- [ ] 错误处理已定义？

### 清晰度
- [ ] 无模糊词汇（"快速"/"大量"等）？
- [ ] 验收标准可客观测量？

### 一致性
- [ ] User Stories 之间无冲突？
- [ ] 与项目原则（Constitution）一致？

### 待澄清项（≤3 个）
| # | 问题 | 影响 | 建议答案 |
|---|------|------|----------|
| Q1 | ... | 范围 | A/B/C |
```

#### D. 按 User Story 组织任务 (借鉴 Spec-Kit)

**改进 TSK 组织方式：**
```markdown
## Phase 1: Setup (共享基础设施)
- [ ] TSK-001 初始化项目结构

## Phase 2: User Story 1 - [标题] (P1 - MVP) 🎯
**目标**: [Story 描述]
**独立验证**: [如何验证]

- [ ] TSK-002 [US1] 实现 XXX 模型
- [ ] TSK-003 [US1] 实现 XXX 服务
- [ ] TSK-004 [US1] 实现 XXX API

**检查点**: US1 可独立演示

## Phase 3: User Story 2 - [标题] (P2)
...
```

#### E. Handoffs 结构化 (借鉴 Spec-Kit)

**在命令 YAML 头部增加：**
```yaml
---
handoffs:
  - label: 技术设计
    command: /lead
    prompt: 进行技术评审和任务分解
  - label: 需求澄清
    command: /clarify
    prompt: 澄清待确认项
---
```

---

## 三、新增命令设计

### 3.1 /clarify - 需求澄清命令

**定位**: 在 /pm 和 /lead 之间，澄清不确定项

```markdown
---
allowed-tools:
  - Read
  - Write
  - Edit
  - WebSearch
  - AskUserQuestion
handoffs:
  - label: 技术设计
    command: /lead
    prompt: 进行技术评审
---

# /clarify - 需求澄清智能体

解决 REQ 文档中的待澄清项，确保需求足够清晰才能进入设计阶段。

## 触发条件
- REQ 文档中有"待澄清项"
- PM 决策置信度为"低"的项目

## 澄清规则
1. **最多 5 个问题**（单次澄清）
2. **优先级**: 范围 > 安全 > 用户体验 > 技术细节
3. **提供建议答案**，用户可选择或自定义

## 输出
- 更新 REQ 文档，移除 [待澄清] 标记
- 记录澄清结果和决策依据
```

### 3.2 /quality-check - 需求质量检查

**定位**: 检查需求文档质量，而非检查代码

```markdown
---
allowed-tools:
  - Read
  - Write
handoffs:
  - label: 继续设计
    command: /lead
---

# /quality-check - 需求质量检查

执行"需求的单元测试"，验证需求文档的质量。

## 核心理念
> Checklist = Unit Tests for Requirements
> 检查的是需求是否写得好，而非代码是否实现好

## 检查维度
1. **完整性** - 所有必要需求都有？
2. **清晰度** - 需求是否无歧义？
3. **一致性** - 需求之间是否一致？
4. **可测量性** - 是否可客观验证？
5. **覆盖度** - 是否覆盖所有场景？

## 输出
- 质量检查报告
- 需要改进的具体问题
- 通过/不通过建议
```

### 3.3 /analyze - 一致性分析

**定位**: 检查 REQ-DES-TSK 之间的一致性

```markdown
---
allowed-tools:
  - Read
  - Grep
  - Glob
---

# /analyze - 一致性分析

分析需求、设计、任务之间的一致性，发现冲突和遗漏。

## 检查内容
1. **需求覆盖度** - 每个需求是否有对应任务？
2. **术语一致性** - 同一概念是否使用相同名称？
3. **设计合规性** - 设计是否符合项目原则？
4. **任务完整性** - 任务是否覆盖所有设计点？

## 输出
- 一致性分析报告
- 发现的冲突和遗漏
- 建议的修复措施
```

---

## 四、增强的 Agent 设计

### 4.1 requirement-validator Agent

**定位**: 需求质量验证

```yaml
---
name: requirement-validator
description: "需求质量验证智能体：执行需求的单元测试"
model: sonnet
permissionMode: plan
tools:
  - Read
  - Grep
---

# Requirement Validator Agent

执行"需求的单元测试"，检查需求文档的质量。

## 检查问题类型

### ✅ 正确的检查（测试需求质量）
- "是否为所有按钮定义了点击处理要求？"
- "视觉层级要求是否有具体的尺寸/位置定义？"
- "错误处理要求是否覆盖所有失败模式？"

### ❌ 错误的检查（测试实现）
- "验证按钮点击是否正确"
- "测试错误处理是否工作"
- "确认 API 返回 200"

## 输出格式
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 完整性 | ✓/✗ | [具体问题] |
| 清晰度 | ✓/✗ | [具体问题] |
```

### 4.2 consistency-checker Agent

**定位**: 文档一致性检查

```yaml
---
name: consistency-checker
description: "一致性检查智能体：检查 REQ-DES-TSK 一致性"
model: sonnet
permissionMode: plan
tools:
  - Read
  - Grep
  - Glob
---

# Consistency Checker Agent

检查需求、设计、任务文档之间的一致性。

## 检查维度
1. 需求覆盖度
2. 术语一致性
3. 设计合规性
4. 任务完整性

## 输出
一致性分析报告，包含冲突、遗漏、建议
```

---

## 五、完整流程对比

### 5.1 融合后的完整流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           融合后的开发流程                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  /pm                                                                        │
│    ├── 需求分析（含决策置信度）                                               │
│    ├── User Story 优先级（P1/P2/P3）                                         │
│    ├── 需求质量自检（Checklist）                                             │
│    └── 待澄清项（≤3）                                                        │
│         │                                                                   │
│         ↓                                                                   │
│  /clarify（如有待澄清项）                                                     │
│    ├── 逐项澄清                                                              │
│    └── 更新 REQ 文档                                                         │
│         │                                                                   │
│         ↓                                                                   │
│  /quality-check（可选）                                                       │
│    ├── 需求质量验证                                                          │
│    └── 通过后继续                                                            │
│         │                                                                   │
│         ↓                                                                   │
│  /lead                                                                       │
│    ├── PM 决策评审                                                           │
│    ├── 技术设计                                                              │
│    └── 按 User Story 分解任务                                                │
│         │                                                                   │
│         ↓                                                                   │
│  /analyze（可选）                                                             │
│    ├── 一致性检查                                                            │
│    └── 发现问题则回退修复                                                     │
│         │                                                                   │
│         ↓                                                                   │
│  /designer（前端任务）                                                        │
│    ├── UI 设计指导                                                           │
│    └── 避免 AI 通用审美                                                       │
│         │                                                                   │
│         ↓                                                                   │
│  /dev                                                                        │
│    ├── 按 User Story 实现                                                    │
│    ├── 前端调用 /frontend-design                                             │
│    └── 浏览器自测（Playwright）                                               │
│         │                                                                   │
│         ↓                                                                   │
│  /qa                                                                         │
│    ├── 验收测试                                                              │
│    ├── 问题分类（实现Bug vs 假设错误）                                         │
│    └── 通过后继续                                                            │
│         │                                                                   │
│         ↓                                                                   │
│  /checkpoint                                                                 │
│    ├── 验证 + 提交                                                           │
│    ├── 更新文档                                                              │
│    └── /clear → 下一个 User Story                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 简化流程（小型任务）

对于简单任务，可跳过可选步骤：

```
/pm → /lead → /dev → /qa → /checkpoint → /clear
```

### 5.3 完整流程（大型功能）

```
/pm → /clarify → /quality-check → /lead → /analyze → /designer → /dev → /qa → /checkpoint
```

---

## 六、我们的独特价值主张

### 6.1 方法论名称

**"道法术器 + 规范驱动" 融合体系**

或更简洁的：

**"自主规范开发方法论 (ASDM - Autonomous Spec-Driven Methodology)"**

### 6.2 核心差异化

| 特性 | 纯 Spec-Kit | 纯我们模板 | 融合体系 |
|------|------------|-----------|---------|
| 决策模式 | 强制澄清 | 自主推断 | **推断优先 + 关键澄清** |
| 质量保证 | 需求检查 | 下游纠偏 | **双重保障** |
| 流程灵活性 | 固定线性 | 循环迭代 | **可伸缩流程** |
| UI 设计 | 无 | 有 | **有（避免 AI Slop）** |
| 前端验证 | 无 | 有 | **有（Playwright）** |
| 插件生态 | 无 | 有 | **有（官方插件）** |
| 哲学基础 | 单一 | 完整 | **道法术器** |

### 6.3 适用场景

| 场景 | 推荐流程 |
|------|---------|
| 简单 Bug 修复 | /dev → /qa → /checkpoint |
| 中等功能 | /pm → /lead → /dev → /qa → /checkpoint |
| 大型功能 | 完整流程 + 可选步骤 |
| 前端开发 | 包含 /designer + /frontend-design |
| 高风险功能 | 强制 /clarify + /quality-check + /analyze |

---

## 七、实施计划

### 7.1 第一阶段：核心融合

1. **改进 CLAUDE.md** - 增加版本化
2. **改进 REQ 模板** - 增加 User Story 优先级 + 独立可测
3. **改进 /pm** - 增加需求质量自检
4. **改进 /lead** - 按 User Story 组织任务

### 7.2 第二阶段：新增命令

1. **新增 /clarify** - 需求澄清
2. **新增 /quality-check** - 需求质量检查
3. **新增 /analyze** - 一致性分析

### 7.3 第三阶段：Agent 增强

1. **新增 requirement-validator Agent**
2. **新增 consistency-checker Agent**

---

## 八、总结

通过深度分析 Spec-Kit 和我们现有模板，我们识别出：

**从 Spec-Kit 借鉴的精华：**
1. Constitution 版本化管理
2. Checklist = 需求的单元测试
3. User Story 独立可测 (P1/P2/P3)
4. NEEDS CLARIFICATION 限制 (≤3)
5. Handoffs 结构化交接
6. 一致性分析

**我们独有的优势：**
1. 道法术器哲学体系
2. 自主决策 + 决策置信度
3. 问题分类能力（实现Bug vs 假设错误）
4. Designer 角色（避免 AI Slop）
5. 前端验证（Playwright）
6. 官方插件生态

**融合后的独特价值：**
- **推断优先 + 关键澄清** 的决策模式
- **双重质量保障**（需求检查 + 下游纠偏）
- **可伸缩流程**（简单任务简化，复杂任务完整）
- **完整的方法论基础**（道法术器）

这不是简单的拼凑，而是形成了一个有机的、独特的开发方法论体系。
